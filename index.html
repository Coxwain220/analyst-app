<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyst V11 - PRECISION STRIKE</title>
    <style>
        :root { --bg-color: #000000; --text-primary: #00FF00; }
        body { background-color: var(--bg-color); color: var(--text-primary); font-family: monospace; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        button {
            background: #111; color: var(--text-primary); border: 2px solid var(--text-primary);
            padding: 20px; font-size: 1.2rem; font-weight: bold; cursor: pointer; width: 100%;
            margin-bottom: 20px; border-radius: 5px; text-transform: uppercase;
        }
        
        #logWindow {
            background: #111; color: #888; padding: 15px; width: 100%; height: 250px; 
            overflow-y: auto; border: 1px solid #333; font-size: 0.9rem; text-align: left;
            white-space: pre-wrap;
        }

        #cockpit { display: none; width: 100%; text-align: center; border: 2px solid green; padding: 20px; margin-top: 20px; }
        .huge { font-size: 2rem; font-weight: 900; margin: 20px 0; color: white; word-break: break-all; }
        .label { color: #666; font-size: 0.8rem; }
    </style>
</head>
<body>

    <button id="btnScan">CONNECT TO SERVICE 30</button>
    
    <div id="cockpit">
        <h2 style="color:white; margin:0;">DATA FLOWING</h2>
        <div class="label">RAW HEX STREAM</div>
        <div class="huge" id="hexDisplay">WAITING...</div>
        <p style="color:#888">SCREENSHOT THIS NOW</p>
    </div>

    <div id="logWindow">System Ready. Target: CE060030...</div>

    <script>
        const btnScan = document.getElementById('btnScan');
        const logWindow = document.getElementById('logWindow');
        
        // UPDATED TARGETS BASED ON YOUR LOGS
        // Service 0030 is where the data lives on your firmware
        const TARGET_SERVICE = 'ce060030-43e5-11e4-916c-0800200c9a66';
        const TARGET_CHAR    = 'ce060031-43e5-11e4-916c-0800200c9a66'; 

        function log(msg) {
            logWindow.innerHTML = "> " + msg + "\n" + logWindow.innerHTML;
        }

        btnScan.addEventListener('click', async () => {
            try {
                log("1. Scanning for PM5...");
                
                // Request access to the specific service we saw in your logs
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: 'PM5' }],
                    optionalServices: [TARGET_SERVICE]
                });

                log(`2. Found: ${device.name}`);
                log("3. Connecting...");
                
                const server = await device.gatt.connect();
                log("4. CONNECTED. Getting Service 30...");
                
                // Direct hit on the service you saw
                const service = await server.getPrimaryService(TARGET_SERVICE);
                log("5. Found Service 30! Getting Data Char...");
                
                const characteristic = await service.getCharacteristic(TARGET_CHAR);
                log("6. Subscribing...");
                
                await characteristic.startNotifications();
                characteristic.addEventListener('characteristicvaluechanged', (event) => {
                    const value = event.target.value;
                    let hexStr = Array.from(new Uint8Array(value.buffer))
                        .map(b => b.toString(16).padStart(2,'0').toUpperCase())
                        .join(' ');
                    
                    document.getElementById('hexDisplay').innerText = hexStr;
                    
                    // Unlock Cockpit
                    document.getElementById('cockpit').style.display = 'block';
                    btnScan.style.display = 'none';
                    log("SUCCESS: DATA RECEIVED.");
                });

            } catch (error) {
                log(`FAIL: ${error.message}`);
                // If it fails, print the full error object for debugging
                console.error(error);
            }
        });
    </script>
</body>
</html>

